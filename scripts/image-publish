#!/bin/sh

# _BASE="$(/usr/bin/basename $(pwd))"
_BASE="$(/usr/bin/basename $(git rev-parse --show-toplevel))"
_NAME="$_BASE"
if [[ $_BASE == *-container* ]] ; then
 _NAME=${_BASE%-container}
fi

set -a
# source envs.conf
# source .envs.conf
if [ -f "./args.conf" ] ; then
 source ./args.conf
fi
if [ -f "./.args.conf" ] ; then
 source ./.args.conf
fi
if [ -f "./envs.conf" ] ; then
 source ./envs.conf
fi
if [ -f "./.envs.conf" ] ; then
 source ./.envs.conf
fi
set +a


LOGIN="podman login --username=$DOCKERIO_USERNAME --password=$DOCKERIO_PASSWORD $PUBLISH_REPOSITORY"
# DO NOT LEAVE THIS UNCOMMENTED
echo "$LOGIN"
/bin/sh -c "$LOGIN"
 
PUSH="podman push '$PUBLISH_REPOSITORY/$DOCKERIO_USERNAME/$_NAME:$1'"
echo "$PUSH"
/bin/sh -c "$PUSH"


